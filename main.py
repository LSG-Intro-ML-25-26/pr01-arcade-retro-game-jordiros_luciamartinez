@namespace
class SpriteKind:
    Decorativo = SpriteKind.create()
    Map = SpriteKind.create()

def on_a_pressed():
    if partida:
        SistemaDeDobleSalto()
controller.A.on_event(ControllerButtonEvent.PRESSED, on_a_pressed)

def GenerarMinimapa():
    global myMinimap, mapStripe
    sprites.destroy(mapStripe)
    myMinimap = minimap.minimap(MinimapScale.SIXTEENTH, 1, 15)
    mapStripe = sprites.create(minimap.get_image(myMinimap), SpriteKind.Map)
    minimap.include_sprite(myMinimap, prota, MinimapSpriteScale.DOUBLE)
    mapStripe.set_position(scene.camera_property(CameraProperty.X) + 54,
        scene.camera_property(CameraProperty.Y) - 44)

def on_left_pressed():
    if partida:
        animation.run_image_animation(prota,
            assets.animation("""
                player_left_animated
                """),
            200,
            True)
controller.left.on_event(ControllerButtonEvent.PRESSED, on_left_pressed)

def on_right_released():
    if partida:
        animation.run_image_animation(prota,
            assets.animation("""
                player_right_animated
                """),
            200,
            False)
controller.right.on_event(ControllerButtonEvent.RELEASED, on_right_released)

def on_left_released():
    if partida:
        animation.run_image_animation(prota,
            assets.animation("""
                player_left_animated
                """),
            200,
            False)
controller.left.on_event(ControllerButtonEvent.RELEASED, on_left_released)

def GenerarNivel():
    if nivel == 1:
        scene.set_background_image(assets.image("""
            fondo_nivel_1
            """))
        tiles.set_current_tilemap(tilemap("""
            nivel1
            """))
        prota.y = 460
        prota.x = 20
    elif nivel == 2:
        scene.set_background_image(assets.image("""
            fondo_nivel_2
            """))
        tiles.set_current_tilemap(tilemap("""
            nivel0
            """))
        prota.y = 60
        prota.x = 20
    elif nivel == 3:
        scene.set_background_image(assets.image("""
            fondo_nivel_3
            """))
        tiles.set_current_tilemap(tilemap("""
            nivel3
            """))
        prota.y = 460
        prota.x = 20
def SistemaDeDobleSalto():
    global salto
    if prota.is_hitting_tile(CollisionDirection.BOTTOM):
        prota.set_velocity(0, -125)
        salto = True
        music.play(music.create_song(hex("""
                00f4010408020105001c000f0a006400f4010a00000400000000000000000000000000000000020c0000000400012704000800012a
                """)),
            music.PlaybackMode.IN_BACKGROUND)
    elif salto == True:
        prota.set_velocity(0, -125)
        salto = False
        music.play(music.create_song(hex("""
                00f4010408020105001c000f0a006400f4010a00000400000000000000000000000000000000020c0000000400012704000800012a
                """)),
            music.PlaybackMode.IN_BACKGROUND)

def on_right_pressed():
    if partida:
        animation.run_image_animation(prota,
            assets.animation("""
                player_right_animated
                """),
            200,
            True)
controller.right.on_event(ControllerButtonEvent.PRESSED, on_right_pressed)

def on_down_pressed():
    global mostrar_minimapa
    if partida:
        if mostrar_minimapa:
            mostrar_minimapa = False
            sprites.destroy(mapStripe)
        else:
            mostrar_minimapa = True
controller.down.on_event(ControllerButtonEvent.PRESSED, on_down_pressed)

def MostrarLore():
    game.set_dialog_text_color(2)
    game.set_dialog_frame(assets.image("""
        fondo_1
        """))
    game.show_long_text("El caballero End debe adentrarse al castillo oscuro y derrotar a los 3 reyes que gobiernan el reino Nochesfera, restaurando as√≠ la paz.",
        DialogLayout.FULL)
def MostrarInstrucciones():
    game.set_dialog_text_color(2)
    game.set_dialog_frame(assets.image("""
        fondo_1
        """))
    game.show_long_text("A : Saltar\\nA+A : Doble salto\\nB : Atacar\\nDER./IZQ. : Moverse\\nBAJO : Minimapa",
        DialogLayout.FULL)
def CreacionPersonajes():
    global prota
    info.set_life(3)
    prota = sprites.create(assets.image("""
        player
        """), SpriteKind.player)
    controller.move_sprite(prota, 100, 0)
    scene.camera_follow_sprite(prota)
    prota.ay = 200
salto = False
nivel = 0
prota: Sprite = None
myMinimap: minimap.Minimap = None
mapStripe: Sprite = None
mostrar_minimapa = False
partida = False
menu = True
partida = False
mostrar_minimapa = True
scene.set_background_image(img("""
    ...............................................................................................................................................................
    ...............................................................................................................................................................
    ...............................................................................................................................................................
    ...............................................................................................................................................................
    ...................................................................................................22222222222222222222222222222222222222......................
    ...........................................................................................222222222222222222222222222222222222222222222222222222..............
    .....................................................................................222222222222222222222222222222222222222222222222222222222222222222........
    ................................................................................222222222222222222222222222222222444444444422222222222222222222222222222222....
    .............................................................................222222222222222222222244444444444444444444444444444444444444422222222222222222....
    ..22222.................................................................22222222222222222224444444444444444444444444444444444444444444444444444444222222222....
    ..2222222222......................................................22222222222222222224444444444444444444444444444444444444444444444444444444444444444442222....
    ..222222222222222222.......................................222222222222222222244444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..22224222222222222222222222222222..........222222222222222222222222222244444444444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..2222444444422222222222222222222222222222222222222222222222222222444444444444444444444444444444444444444444444444444444444444444444444444444444444444442222...
    ..2222444444444444444222222222222222222222222222222222222244444444444444444444444444444444444444444444444444444444444444444444444444222222224444444444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444244444444444444444422224444222244444444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444442244444444444444444222444444442224444444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444442244444444444422444444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444422444444224444442244444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444424422444444444444422444444222444442224444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444442442244222422444444444444224444444242444444224444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444424442242224422422444444444444224444442242444444224444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444444444444444444444222442422442244224422442444444444444244444442442244444424444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444422244444442242222224442442242244224422442244444444444244444442444244444424444442222...
    ..2222444444444444444444444444444444444444444444444444444444444444444444442244444442224224424442242444244224422442244444444444244444422222244444424444442222...
    ..2222444444444444444422444444444444444444444444444444444444444444444444444244444444224224422442224444244224442242224444444444244444422222224444424444442222...
    ..2222444444444444444422244442244444444422444444444444444444444444444222444224444444224224422442244444224424442244444444444444244444424444224444424444442222...
    ..2222444444444444444442224442244444444422442444444444444444444444444222244224444444224424422442222444224424444444444444444444224444224444424444224444442222...
    ..2222444444444444444444224444244442444422442444444444444424444444444442244224444444224422422444424444444444444444444444444444224444244444424444224444442222...
    ..2222444444444444444444222224224222224422442242244422244422424444444242244424444444224422444444444444444444444444444444444444422444444444444442244444442222...
    ..2222444444444444444444224444244224224422442242224222224422424444444242244422444444444444444444444444444444444444444444444444442244444444444442244444442222...
    ..2222444444444444444442224444244224424422442244224224424422444444444244224422444444444444444444444444444444444444444444444444444224444444444222444444442222...
    ..2222444444444444444444224442244224424422442244224222444422444444442224224444444444444444444444444444444444444444444444444444444422244444442224444444442222...
    ..2222444444444444444444244442444224424422442244224224444422444444444224444444444444444444444444444444444444444444444444444444444442222222222444444444442222...
    ..2222444444444444444444244424444224424422442244224224444422444444444444444444444444444444444444444444444444444444444444444444444444442222444444444444442222...
    ..222244444444444444444222224444422222442224222224422242422224444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..222244444444444444444244444444444244444444444444444244444244444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444442222222222222222222222222222222444444444444444444222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444444444444444444422222222222222222222222222222222222222222222222222444444444222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444444444444422222222222222222222222222222222222222222222222222222222222222242222....
    ..222244444444444444444444444444444444444444444444444444444444444444444444444442222222222222222222222..................................22222222222222222222....
    ..2222444444444444444444444444444444444444444444444444444444444444444444422222222222222222222..................................................222222222222....
    ..2222222224444444444444444444444444444444444444444444444444444444422222222222222222222...............................................................22222....
    ..22222222222222224444444444444444444444444444444444444444422222222222222222222222.............................................................................
    ..222222222222222222222222222222244444444444444222222222222222222222222222222..................................................................................
    ......222222222222222222222222222222222222222222222222222222222222222222.......................................................................................
    ............222222222222222222222222222222222222222222222222222222.............................................................................................
    ....................2222222222222222222222222222222222222222...................................................................................................
    ........................................222....................................................................................................................
    ...............................................................................................................................................................
    ...............................................................................................................................................................
    """))

def on_update_interval():
    global menu, nivel, partida
    if menu:
        scene.set_background_image(assets.image("""
            fondo_menu
            """))
        if controller.A.is_pressed():
            menu = False
    elif not (partida):
        nivel = 1
        MostrarLore()
        MostrarInstrucciones()
        CreacionPersonajes()
        GenerarNivel()
        partida = True
    elif mostrar_minimapa:
        GenerarMinimapa()
game.on_update_interval(1, on_update_interval)
